<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BINGO ETHIO GOLD - ALL-IN-ONE</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --green: #22c55e; --yellow: #facc15; --red: #ef4444; --dark: #0f172a; --card: #1e293b; --text: #f8fafc; }
        body { background: var(--dark); color: var(--text); font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 0; touch-action: manipulation; }

        /* Navigation */
        .top-nav { display: flex; background: #1e293b; padding: 12px; justify-content: space-around; border-bottom: 2px solid var(--yellow); position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .nav-btn { color: #94a3b8; padding: 8px 12px; cursor: pointer; font-weight: bold; border-radius: 8px; font-size: 0.75rem; transition: 0.3s; }
        .nav-btn.active { color: var(--yellow); background: #334155; }

        /* General Layout */
        .page { display: none; padding: 15px; text-align: center; animation: fadeIn 0.3s ease-in; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Bingo Ball Style */
        .ball { width: 90px; height: 90px; background: radial-gradient(circle at 30% 30%, var(--yellow), #a16207); border-radius: 50%; margin: 20px auto; display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: 900; color: #000; box-shadow: 0 0 20px var(--yellow); border: 4px solid #fff; }
        
        /* Game Board */
        .bingo-card { background: white; padding: 8px; border-radius: 12px; max-width: 320px; margin: 0 auto; color: #000; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; }
        .cell { aspect-ratio: 1; background: #f1f5f9; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; font-weight: 800; border-radius: 6px; border: 1px solid #cbd5e1; }
        .cell.marked { background: var(--red) !important; color: white !important; border-radius: 50%; transform: scale(0.9); transition: 0.2s; }

        /* Admin & Wallet Box */
        .admin-box { background: var(--card); padding: 15px; border-radius: 12px; margin-top: 15px; border: 1px solid #334155; text-align: left; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 14px; border-radius: 10px; border: 1px solid #334155; background: #0f172a; color: white; margin: 10px 0; box-sizing: border-box; font-size: 1rem; }
        .main-btn { width: 100%; padding: 16px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 1.1rem; transition: 0.3s; margin-top: 10px; }
        .btn-green { background: var(--green); color: white; }
        .btn-yellow { background: var(--yellow); color: black; }
        .btn-red { background: var(--red); color: white; }

        /* Card Picker Grid */
        #picker { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .card-node { background: var(--card); padding: 15px 5px; border-radius: 10px; font-weight: bold; border: 1px solid #334155; cursor: pointer; }
    </style>
</head>
<body>

    <div class="top-nav">
        <div class="nav-btn active" onclick="showPage('play', this)">ğŸ•¹ áˆ˜áŒ«á‹ˆá‰»</div>
        <div class="nav-btn" id="admin-nav" style="display: none;" onclick="showPage('admin', this)">ğŸ”‘ áŠ á‹µáˆšáŠ•</div>
        <div class="nav-btn" onclick="showPage('wallet', this)">ğŸ’° á‰¥áˆ­</div>
    </div>

    <div id="play" class="page active">
        <div style="background:var(--card); padding:10px; border-radius:10px; margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
            <span>á‰£áˆ‹áŠ•áˆµ: <b id="user-balance" style="color:var(--green)">0.00</b> ETB</span>
            <small style="color:var(--yellow)">á‹‹áŒ‹: 10 ETB</small>
        </div>

        <div id="selector">
            <h3>áŠ«áˆ­á‰´áˆ‹ á‹­áˆáˆ¨áŒ¡</h3>
            <div id="picker"></div>
        </div>

        <div id="game" style="display:none;">
            <div class="ball" id="live-ball">?</div>
            <p style="color:var(--yellow); font-weight:bold; margin-bottom:10px;">á‹¨á‹ˆáŒ£á‹ á‰áŒ¥áˆ­</p>
            <div class="bingo-card">
                <div class="grid" id="board"></div>
            </div>
            <button class="main-btn btn-green" onclick="claimBingo()">BINGO!</button>
            <button onclick="location.reload()" style="background:none; color:#94a3b8; border:none; margin-top:15px; cursor:pointer;">ğŸ”„ á‰°áˆ˜áˆˆáˆµ</button>
        </div>
    </div>

    <div id="admin" class="page">
        <h2>áŠ á‹µáˆšáŠ• áˆ˜á‰†áŒ£áŒ áˆªá‹«</h2>
        <div class="ball" id="admin-ball">?</div>
        
        <div class="admin-box">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>áˆáŒ£áŠ• áˆ›á‹áŒ« (Auto 3s)</span>
                <input type="checkbox" id="auto-check" onchange="toggleAuto()" style="width:25px; height:25px;">
            </div>
            <button class="main-btn btn-yellow" onclick="drawNumber()">áŠ áˆáŠ‘áŠ‘ áŠ á‹áŒ£</button>
        </div>

        <div class="admin-box">
            <h4 style="color:var(--yellow); margin:0 0 10px 0;">á‹¨á‰¥áˆ­ áˆ˜á‰€á‰ á‹« áˆµáˆáŠ­</h4>
            <input type="tel" id="admin-phone-input" value="0991243423">
            <button class="main-btn btn-green" style="padding:10px;" onclick="updatePhone()">á‰áŒ¥áˆ©áŠ• á‰€á‹­áˆ­</button>
        </div>

        <div class="admin-box" id="withdraw-section">
            <h4 style="color:var(--red); margin:0 0 10px 0;">á‹¨áˆ›á‹áŒ« áŒ¥á‹«á‰„á‹á‰½</h4>
            <div id="admin-requests" style="font-size: 0.85rem;">áŒ¥á‹«á‰„ á‹¨áˆˆáˆ...</div>
        </div>

        <button class="main-btn btn-red" onclick="resetGame()" style="margin-top: 30px;">âš ï¸ áŠ á‹²áˆµ á‹™áˆ­ áŒ€áˆáˆ­</button>
    </div>

    <div id="wallet" class="page">
        <h3>á‰£áˆ‹áŠ•áˆµáŠ“ áˆ›á‹áŒ«</h3>
        
        <div class="admin-box" style="border-left: 5px solid var(--yellow);">
            <h4 style="color:var(--yellow); margin:0 0 10px 0;">ğŸ“¥ á‰¥áˆ­ áˆ›áˆµáŒˆá‰¢á‹«</h4>
            <p>á‰´áˆŒá‰¥áˆ­ á‰áŒ¥áˆ­: <b id="pay-phone" style="color:var(--green); font-size:1.2rem;">0991243423</b></p>
            <input type="text" id="dep-tid" placeholder="á‹¨áŒá‰¥á‹­á‰µ á‰áŒ¥áˆ­ (TID) á‹«áˆµáŒˆá‰¡">
            <button class="main-btn btn-yellow" onclick="requestDeposit()">á‰£áˆ‹áŠ•áˆµ áŒ¨áˆáˆ­</button>
        </div>

        <div class="admin-box" style="border-left: 5px solid var(--red);">
            <h4 style="color:var(--red); margin:0 0 10px 0;">ğŸ’¸ á‰¥áˆ­ áˆ›á‹áŒ«</h4>
            <input type="number" id="w-amount" placeholder="á‹¨á‰¥áˆ­ áˆ˜áŒ áŠ•">
            <input type="tel" id="w-phone" placeholder="á‹¨á‰´áˆŒá‰¥áˆ­ áˆµáˆáŠ­">
            <button class="main-btn btn-red" onclick="requestWithdraw()">áŠ áˆáŠ• áŠ á‹áŒ£</button>
        </div>
    </div>

    <script>
        // --- ğŸ”´ Firebase Setup (á‹«áŠ•á‰°áŠ• áˆ˜áˆ¨áŒƒ áŠ¥á‹šáˆ… á‰°áŠ«) ---
        const firebaseConfig = {
            apiKey: "AIzaSy...", 
            databaseURL: "https://your-bingo-id.firebaseio.com",
            projectId: "your-bingo-id"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const tg = window.Telegram.WebApp;
        tg.expand();

        const MY_ADMIN_ID = 123456789; // á‹«áŠ•á‰° ID
        let currentBalance = 0;
        let autoInterval = null;

        // 1. Sync Number (áŠ¨á‹³á‰³á‰¤á‹)
        db.ref('game/currentNum').on('value', (snapshot) => {
            const num = snapshot.val() || "?";
            document.getElementById('live-ball').innerText = num;
            document.getElementById('admin-ball').innerText = num;
        });

        // 2. Sync Balance (áŠ¨á‹³á‰³á‰¤á‹)
        if(tg.initDataUnsafe.user) {
            const uid = tg.initDataUnsafe.user.id;
            db.ref('users/' + uid + '/balance').on('value', (snapshot) => {
                currentBalance = snapshot.val() || 0;
                document.getElementById('user-balance').innerText = currentBalance.toFixed(2);
            });
        }

        // 3. Admin Function: Draw
        function drawNumber() {
            let n = Math.floor(Math.random() * 75) + 1;
            db.ref('game/currentNum').set(n);
            tg.HapticFeedback.impactOccurred('medium');
        }

        function toggleAuto() {
            if(document.getElementById('auto-check').checked) {
                autoInterval = setInterval(drawNumber, 3000);
            } else {
                clearInterval(autoInterval);
            }
        }

        // 4. Wallet Functions
        function requestDeposit() {
            const tid = document.getElementById('dep-tid').value;
            if(!tid) return alert("áŠ¥á‰£áŠ­á‹ TID á‹«áˆµáŒˆá‰¡");
            db.ref('requests/deposits').push({
                uid: tg.initDataUnsafe.user.id,
                name: tg.initDataUnsafe.user.first_name,
                tid: tid,
                status: 'pending'
            });
            alert("áŒ¥á‹«á‰„á‹ á‰°áˆáŠ³áˆ! áŠ á‹µáˆšáŠ‘ áˆ²á‹«áˆ¨áŒ‹áŒáŒ¥ á‰¥áˆ­ á‹­áŒ¨áˆ˜áˆ­áˆá‹á‰³áˆá¢");
            document.getElementById('dep-tid').value = "";
        }

        function requestWithdraw() {
            const amt = document.getElementById('w-amount').value;
            const ph = document.getElementById('w-phone').value;
            if(!amt || !ph) return alert("áˆáˆ‰áŠ•áˆ á‹­áˆ™áˆ‰");
            db.ref('requests/withdraws').push({
                uid: tg.initDataUnsafe.user.id,
                name: tg.initDataUnsafe.user.first_name,
                amount: amt,
                phone: ph
            });
            alert("á‹¨áˆ›á‹áŒ« áŒ¥á‹«á‰„ á‰°áˆáŠ³áˆ!");
        }

        // 5. Game Functions
        function buyCard(id) {
            if(currentBalance < 10) return alert("á‰ á‰‚ á‰£áˆ‹áŠ•áˆµ á‹¨áˆˆáˆ!");
            const uid = tg.initDataUnsafe.user.id;
            db.ref('users/' + uid + '/balance').set(currentBalance - 10);
            
            document.getElementById('selector').style.display = 'none';
            document.getElementById('game').style.display = 'block';
            generateBoard(id);
        }

        function generateBoard(seed) {
            const board = document.getElementById('board');
            board.innerHTML = "";
            for(let i=0; i<25; i++) {
                let cell = document.createElement('div');
                cell.className = 'cell';
                cell.innerText = Math.floor(Math.random() * 75) + 1;
                cell.onclick = function() { 
                    this.classList.toggle('marked');
                    tg.HapticFeedback.impactOccurred('light');
                };
                board.appendChild(cell);
            }
        }

        function updatePhone() {
            const ph = document.getElementById('admin-phone-input').value;
            document.getElementById('pay-phone').innerText = ph;
            alert("áˆµáˆáŠ­ á‰áŒ¥áˆ© á‰°á‰€á‹­áˆ¯áˆ!");
        }

        function showPage(id, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
        }

        window.onload = () => {
            const picker = document.getElementById('picker');
            for(let i=1; i<=200; i++) {
                let d = document.createElement('div');
                d.className = 'card-node';
                d.innerText = i;
                d.onclick = () => buyCard(i);
                picker.appendChild(d);
            }
            if(tg.initDataUnsafe.user && tg.initDataUnsafe.user.id === MY_ADMIN_ID) {
                document.getElementById('admin-nav').style.display = 'block';
            }
        };

        function resetGame() {
            if(confirm("áŠ á‹²áˆµ á‹™áˆ­ áˆáŒ€áˆáˆ­?")) {
                db.ref('game/currentNum').set("?");
                clearInterval(autoInterval);
                document.getElementById('auto-check').checked = false;
            }
        }
    </script>
</body>
</html>

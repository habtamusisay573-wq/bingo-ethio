<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ETHIO BINGO GOLD - FULL TITLE VERSION</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --gold: #facc15; --bg: #020617; --green: #10b981; --red: #f43f5e; }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; margin: 0; }
        .header { padding: 15px; background: rgba(15, 23, 42, 0.9); border-bottom: 2px solid var(--gold); display: flex; justify-content: space-between; }
        
        /* B-I-N-G-O Title Styling */
        .bingo-titles { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; max-width: 350px; margin: 10px auto 5px auto; }
        .title-letter { background: var(--gold); color: black; font-weight: 900; font-size: 1.5rem; border-radius: 8px; padding: 5px 0; text-align: center; }

        .bingo-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; max-width: 350px; margin: auto; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 0 0 15px 15px; }
        .cell { aspect-ratio: 1; background: #fff; color: #000; display: flex; align-items: center; justify-content: center; font-weight: 800; border-radius: 8px; font-size: 1.2rem; cursor: pointer; }
        .cell.marked { background: var(--red) !important; color: white !important; }
        .cell.hint { background: #fef08a; border: 2px solid var(--gold); }
        .cell.free { background: var(--gold) !important; font-size: 0.7rem; }

        .ball-display { width: 100px; height: 100px; background: radial-gradient(circle at 30% 30%, #fff, var(--gold) 40%, #854d0e); border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 20px auto; border: 4px solid #fff; box-shadow: 0 0 20px rgba(250, 204, 21, 0.5); }
        .ball-letter { font-size: 1.2rem; font-weight: bold; color: #333; line-height: 1; }
        .ball-number { font-size: 2.5rem; font-weight: 900; color: #000; line-height: 1; }

        .page { display: none; padding: 20px; }
        .page.active { display: block; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; margin-top: 10px; cursor: pointer; }
        .btn-gold { background: var(--gold); color: black; }
    </style>
</head>
<body>

    <div class="header">
        <div><b id="u-name">...</b><br><small>Online: <span id="online-count">0</span></small></div>
        <div id="u-bal" style="color:var(--green); font-weight:bold;">0.00 ETB</div>
    </div>

    <div id="home-page" class="page active">
        <div id="lock-banner" style="display:none; color:var(--red); text-align:center; margin-bottom:10px; font-weight:bold;">üõë ·å®·ãã·â≥ ·â∞·åÄ·àù·àØ·àç!</div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button onclick="join(10)" class="btn" style="background:#1e293b; color:white;">10 ETB</button>
            <button onclick="join(50)" class="btn" style="background:#1e293b; color:white;">50 ETB</button>
            <button onclick="join(100)" class="btn" style="background:#1e293b; color:white;">100 ETB</button>
            <button onclick="join(200)" class="btn" style="background:#1e293b; color:white;">200 ETB</button>
        </div>
        <button id="admin-btn" class="btn" style="display:none; background:var(--green); color:white; margin-top:40px;" onclick="showPage('admin-page')">‚öôÔ∏è ·ã≥·äõ (ADMIN)</button>
    </div>

    <div id="game-page" class="page">
        <div class="ball-display">
            <div class="ball-letter" id="letter-disp">-</div>
            <div class="ball-number" id="number-disp">?</div>
        </div>
        
        <div class="bingo-titles">
            <div class="title-letter">B</div>
            <div class="title-letter">I</div>
            <div class="title-letter">N</div>
            <div class="title-letter">G</div>
            <div class="title-letter">O</div>
        </div>
        <div class="bingo-grid" id="board"></div>
        
        <button class="btn btn-gold" style="height:70px; font-size:1.5rem;" onclick="checkBingo()">BINGO!</button>
    </div>

    <div id="admin-page" class="page">
        <div class="ball-display">
            <div class="ball-letter" id="admin-letter">-</div>
            <div class="ball-number" id="admin-number">?</div>
        </div>
        <button class="btn btn-gold" onclick="draw()">·âÅ·å•·à≠ ·ä†·ãç·å£</button>
        <button class="btn" id="lock-btn" style="background:var(--red); color:white;" onclick="toggleLock()">·àò·åç·â¢·ã´ ·ãù·åã (Lock)</button>
        <button class="btn" style="background:#475569; color:white; margin-top:40px;" onclick="reset()">RESET GAME</button>
        <button class="btn" onclick="showPage('home-page')">·â∞·àò·àà·àµ</button>
    </div>

    <script>
        const ADMIN_ID = 8431270634;
        const config = { databaseURL: "https://dagi-bingo-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(config);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;

        const uid = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "TEST";
        const uName = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.first_name : "Player";
        if(uid == ADMIN_ID) document.getElementById('admin-btn').style.display = 'block';

        let myBal = 0, drawn = [], isLocked = false, selectedPrice = 0;

        // B-I-N-G-O Logic
        function getLetter(num) {
            if(num <= 15) return "B";
            if(num <= 30) return "I";
            if(num <= 45) return "N";
            if(num <= 60) return "G";
            return "O";
        }

        // Firebase Sync
        db.ref('users/'+uid+'/bal').on('value', s => { myBal = s.val()||0; document.getElementById('u-bal').innerText = myBal.toFixed(2)+" ETB"; });
        db.ref('game/isLocked').on('value', s => { 
            isLocked = s.val(); 
            document.getElementById('lock-banner').style.display = isLocked ? 'block' : 'none';
        });
        db.ref('game/drawn').on('value', s => {
            drawn = s.val() || [];
            let last = drawn[drawn.length-1];
            if(last) {
                let letter = getLetter(last);
                document.getElementById('letter-disp').innerText = letter;
                document.getElementById('number-disp').innerText = last;
                document.getElementById('admin-letter').innerText = letter;
                document.getElementById('admin-number').innerText = last;
            }
            document.querySelectorAll('.cell').forEach(c => { if(drawn.includes(parseInt(c.innerText))) c.classList.add('hint'); });
        });

        // Online Count
        db.ref('status').on('value', s => document.getElementById('online-count').innerText = s.numChildren());
        db.ref('status/'+uid).set(true); db.ref('status/'+uid).onDisconnect().remove();

        function join(p) {
            if(isLocked) return alert("·àò·åç·â¢·ã´ ·â∞·ãò·åç·â∑·àç!");
            if(myBal < p) return alert("·â£·àã·äï·àµ ·ã®·àà·àù!");
            selectedPrice = p;
            db.ref('users/'+uid+'/bal').set(myBal - p);
            genBoard(); showPage('game-page');
        }

        function genBoard() {
            const board = document.getElementById('board'); board.innerHTML = "";
            let cols = [
                shuffle(range(1,15)).slice(0,5),
                shuffle(range(16,30)).slice(0,5),
                shuffle(range(31,45)).slice(0,5),
                shuffle(range(46,60)).slice(0,5),
                shuffle(range(61,75)).slice(0,5)
            ];
            for(let r=0; r<5; r++) {
                for(let c=0; c<5; c++) {
                    let div = document.createElement('div'); div.className = 'cell';
                    let val = cols[c][r];
                    if(r===2 && c===2) { div.innerText = "FREE"; div.classList.add('free'); }
                    else { div.innerText = val; }
                    div.onclick = function() { if(drawn.includes(parseInt(this.innerText)) || this.innerText==="FREE") this.classList.toggle('marked'); };
                    board.appendChild(div);
                }
            }
        }

        function draw() {
            let n; do { n = Math.floor(Math.random()*75)+1; } while(drawn.includes(n));
            drawn.push(n); db.ref('game/drawn').set(drawn);
            if(drawn.length === 1) db.ref('game/isLocked').set(true);
        }

        function toggleLock() { db.ref('game/isLocked').set(!isLocked); }
        function reset() { db.ref('game').set({drawn:[], isLocked:false, winner:null}); }
        function showPage(p) { document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active')); document.getElementById(p).classList.add('active'); }
        function range(s,e) { return Array.from({length:e-s+1},(_,i)=>s+i); }
        function shuffle(a) { return a.sort(()=>Math.random()-0.5); }

        function checkBingo() {
            // (·â¢·äï·åé ·âº·ä≠ ·ã®·àõ·ãµ·à®·åä·ã´ ·àé·åÇ·ä≠ ·ä•·ãö·àÖ ·ã≠·âÄ·å•·àã·àç...)
            alert("·ã≥·äõ·ãç ·åã·à≠ ·âº·ä≠ ·ä•·ã®·â∞·ã∞·à®·åà ·äê·ãç...");
        }
    </script>
</body>
</html>

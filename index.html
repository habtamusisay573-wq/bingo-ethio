<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ETHIO BINGO</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --gold: #facc15; --bg: #0f172a; --card: #1e293b; --green: #22c55e; --red: #ef4444; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; overflow: hidden; }
        
        /* 1. Transition & Logo Section */
        #splash { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; transition: 1s ease-in-out; }
        .logo-text { font-size: 3rem; font-weight: 900; color: var(--gold); text-shadow: 0 0 20px var(--gold); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); opacity: 0.8; } }

        /* General Layout */
        .header { display: flex; justify-content: space-between; padding: 12px; background: #111827; border-bottom: 2px solid var(--gold); }
        .page { display: none; padding: 15px; height: 90vh; overflow-y: auto; animation: fadeIn 0.5s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Game Elements */
        .ball { width: 80px; height: 80px; background: radial-gradient(circle at 30% 30%, #fff, var(--gold), #a16207); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: 900; color: #000; margin: 15px auto; border: 3px solid #fff; }
        .bingo-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; background: #cbd5e1; padding: 8px; border-radius: 12px; max-width: 320px; margin: auto; }
        .cell { aspect-ratio: 1; background: white; color: #1e293b; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 6px; font-size: 1.2rem; }
        .cell.marked { background: var(--red) !important; color: white !important; border-radius: 50%; }

        /* Buttons & Tabs */
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-gold { background: var(--gold); color: black; }
        .card-picker-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 10px; }
        .card-num-btn { background: var(--card); border: 1px solid #334155; color: white; padding: 12px; border-radius: 8px; }
    </style>
</head>
<body>

    <div id="splash">
        <div class="logo-text">ETHIO BINGO</div>
        <p style="color: #94a3b8; margin-top: 10px;">á‰ áˆ˜áŒ«áŠ• áˆ‹á‹­...</p>
    </div>

    <div id="app-content" style="display:none;">
        <div class="header">
            <div id="u-name">áˆ°áˆ‹áˆ</div>
            <div id="u-bal" style="color:var(--green); font-weight:bold;">0.00 ETB</div>
        </div>

        <div id="home-page" class="page active">
            <h3 style="color:var(--gold)">á‹¨áˆ˜á‹ˆáˆ«áˆ¨áŒƒ áˆ˜áŒ áŠ• á‹­áˆáˆ¨áŒ¡</h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                <div onclick="goToCardPicker(10)" style="background:var(--card); padding:15px; border-radius:12px;">10</div>
                <div onclick="goToCardPicker(20)" style="background:var(--card); padding:15px; border-radius:12px;">20</div>
                <div onclick="goToCardPicker(50)" style="background:var(--card); padding:15px; border-radius:12px;">50</div>
                <div onclick="goToCardPicker(100)" style="background:var(--card); padding:15px; border-radius:12px;">100</div>
                <div onclick="goToCardPicker(500)" style="background:var(--card); padding:15px; border-radius:12px;">500</div>
                <div onclick="goToCardPicker(1000)" style="background:var(--card); padding:15px; border-radius:12px;">1000</div>
            </div>
            <div style="margin-top:20px; background:var(--card); padding:15px; border-radius:15px;">
                <p>á‰´áˆŒá‰¥áˆ­: <b>0991243423</b></p>
                <input type="text" id="tid" placeholder="TID á‹«áˆµáŒˆá‰¡" style="width:100%; padding:12px; border-radius:8px; border:none; background:#0f172a; color:white;">
                <button class="btn btn-gold" onclick="sendPayment()">á‰¥áˆ­ áŠ áˆµáŒˆá‰£</button>
            </div>
            <button id="admin-btn" class="btn" style="background:var(--green); display:none;" onclick="showAdmin()">ğŸ”§ á‹³áŠ› áŒˆáŒ½</button>
        </div>

        <div id="picker-page" class="page">
            <h3 style="color:var(--gold)">áŠ«áˆ­á‰´áˆ‹ á‹­áˆáˆ¨áŒ¡ (1-200)</h3>
            <div class="card-picker-grid" id="card-list"></div>
            <button class="btn" style="background:#444; color:white;" onclick="showPage('home-page')">á‰°áˆ˜áˆˆáˆµ</button>
        </div>

        <div id="game-page" class="page">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <button onclick="confirmExit()" style="background:var(--red); color:white; border:none; padding:8px 12px; border-radius:8px;">â¬… á‹áŒ£</button>
                <span id="active-card-label" style="color:var(--gold); font-weight:bold;"></span>
            </div>
            <div class="ball" id="live-ball">?</div>
            <div class="bingo-grid" id="board"></div>
            <button class="btn btn-gold" style="margin-top:20px;" onclick="alert('á‰¢áŠ•áŒ á‰°áˆáŠ³áˆ!')">BINGO!</button>
        </div>

        <div id="admin-page" class="page">
            <h2 style="color:var(--gold)">á‹¨á‹³áŠ› áˆ˜á‰†áŒ£áŒ áˆªá‹«</h2>
            <div class="ball" id="admin-ball">?</div>
            <button class="btn btn-gold" onclick="drawSingle()">á‰áŒ¥áˆ­ áŠ á‹áŒ£</button>
            <button id="auto-btn" class="btn btn-green" onclick="toggleAuto()">Auto áŒ€áˆáˆ­</button>
            <h3 style="margin-top:20px; color:var(--gold)">á‹¨áŠ­áá‹« áŒ¥á‹«á‰„á‹á‰½</h3>
            <div id="req-list">áŒ¥á‹«á‰„ á‹¨áˆˆáˆ...</div>
            <button class="btn btn-red" onclick="resetGame()">RESET</button>
            <button class="btn" onclick="showPage('home-page')">áˆ˜áŠáˆ»</button>
        </div>
    </div>

    <script>
        const ADMIN_ID = 8431270634;
        const firebaseConfig = { databaseURL: "https://dagi-bingo-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;
        tg.expand();

        // 1. Transition Logic
        setTimeout(() => {
            const splash = document.getElementById('splash');
            splash.style.opacity = '0';
            setTimeout(() => {
                splash.style.display = 'none';
                document.getElementById('app-content').style.display = 'block';
                document.body.style.overflow = 'auto';
            }, 1000);
        }, 2500);

        let myBal = 0, drawn = [], autoInterval = null, selectedPrice = 0;
        const uid = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 0;

        if(uid == ADMIN_ID) document.getElementById('admin-btn').style.display = 'block';
        document.getElementById('u-name').innerText = tg.initDataUnsafe.user ? "áˆ°áˆ‹áˆ " + tg.initDataUnsafe.user.first_name : "áˆ°áˆ‹áˆ";

        db.ref('users/' + uid + '/bal').on('value', s => {
            myBal = s.val() || 0;
            document.getElementById('u-bal').innerText = myBal.toFixed(2) + " ETB";
        });

        db.ref('game/drawn').on('value', s => {
            drawn = s.val() || [];
            const last = drawn[drawn.length - 1] || "?";
            document.getElementById('live-ball').innerText = last;
            document.getElementById('admin-ball').innerText = last;
        });

        function goToCardPicker(price) {
            if(myBal < price) return alert("á‰ á‰‚ áˆ‚áˆ³á‰¥ á‹¨áˆˆáˆ!");
            selectedPrice = price;
            showPage('picker-page');
            const list = document.getElementById('card-list');
            list.innerHTML = "";
            for(let i=1; i<=200; i++) {
                let b = document.createElement('button');
                b.className = 'card-num-btn'; b.innerText = i;
                b.onclick = () => startGame(i);
                list.appendChild(b);
            }
        }

        function startGame(num) {
            db.ref('users/' + uid + '/bal').set(myBal - selectedPrice);
            document.getElementById('active-card-label').innerText = "áŠ«áˆ­á‰´áˆ‹ #" + num;
            showPage('game-page');
            const board = document.getElementById('board');
            board.innerHTML = "";
            let nums = Array.from({length: 75}, (_, i) => i + 1).sort(() => Math.random() - 0.5);
            for(let i=0; i<25; i++) {
                let cell = document.createElement('div');
                cell.className = 'cell'; cell.innerText = nums[i];
                cell.onclick = function() { this.classList.toggle('marked'); };
                board.appendChild(cell);
            }
        }

        function sendPayment() {
            const t = document.getElementById('tid').value;
            if(!t) return alert("TID á‹«áˆµáŒˆá‰¡");
            db.ref('deposit_requests').push({ uid, name: tg.initDataUnsafe.user.first_name, tid: t, status: 'pending' });
            alert("áˆˆá‹³áŠ›á‹ á‰°áˆáŠ³áˆ!");
        }

        function showAdmin() {
            showPage('admin-page');
            db.ref('deposit_requests').on('value', s => {
                const list = document.getElementById('req-list');
                list.innerHTML = "";
                s.forEach(child => {
                    const r = child.val();
                    if(r.status == 'pending') {
                        let div = document.createElement('div');
                        div.style = "background:var(--card); padding:10px; margin-bottom:10px; border-left:4px solid var(--gold); text-align:left;";
                        div.innerHTML = `ID: ${r.uid} | TID: ${r.tid} <br> <button onclick="approve('${child.key}','${r.uid}')" style="background:var(--green); color:white; border:none; padding:5px; border-radius:4px; margin-top:5px;">áŠ áŒ½á‹µá‰…</button>`;
                        list.appendChild(div);
                    }
                });
            });
        }

        function approve(key, u) {
            let a = prompt("áˆ˜áŒ áŠ•:", "200");
            if(a) {
                db.ref('users/'+u+'/bal').transaction(b => (b||0) + parseFloat(a));
                db.ref('deposit_requests/'+key).update({status:'approved'});
            }
        }

        function drawSingle() {
            let n; do { n = Math.floor(Math.random()*75)+1; } while(drawn.includes(n));
            drawn.push(n); db.ref('game/drawn').set(drawn);
        }

        function toggleAuto() {
            const btn = document.getElementById('auto-btn');
            if(autoInterval) { clearInterval(autoInterval); autoInterval = null; btn.innerText = "Auto áŒ€áˆáˆ­"; }
            else { autoInterval = setInterval(drawSingle, 4000); btn.innerText = "áŠ á‰áˆ"; }
        }

        function resetGame() { if(confirm("RESET?")) db.ref('game/drawn').set([]); }
        function confirmExit() { if(confirm("áˆ˜á‹áŒ£á‰µ á‰µáˆáˆáŒ‹áˆˆáˆ…?")) showPage('home-page'); }
        function showPage(p) {
            document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active'));
            document.getElementById(p).classList.add('active');
        }
    </script>
</body>
</html>

<div id="home-page" class="page active">
    <div style="margin-top:20px; background:var(--card); padding:15px; border-radius:15px;">
        <h4 style="color:var(--gold); margin:0;">ğŸ“¤ á‰¥áˆ­ áˆˆáˆ›á‹áŒ£á‰µ (Withdraw)</h4>
        <input type="number" id="wd-amt" placeholder="á‹¨á‰¥áˆ­ áˆ˜áŒ áŠ•">
        <input type="text" id="wd-phone" placeholder="á‹¨á‰´áˆŒá‰¥áˆ­ áˆµáˆáŠ­ á‰áŒ¥áˆ­">
        <button class="btn" style="background:var(--red); color:white;" onclick="requestWithdraw()">á‹¨áˆ˜á‹áŒ« áŒ¥á‹«á‰„ áˆ‹áŠ­</button>
    </div>
</div>

<div id="admin-page" class="page">
    <h3 style="margin-top:25px; color:var(--red); text-align:left;">ğŸ“¤ á‹¨á‰¥áˆ­ áˆ›á‹áŒ« áŒ¥á‹«á‰„á‹á‰½</h3>
    <div id="wd-list">áŒ¥á‹«á‰„ á‹¨áˆˆáˆ...</div>
</div>

<script>
    // 1. á‰°áŒ«á‹‹á‰¹ á‹¨á‰¥áˆ­ áˆ›á‹áŒ« áŒ¥á‹«á‰„ áˆ²áˆáŠ­
    function requestWithdraw() {
        const amt = parseFloat(document.getElementById('wd-amt').value);
        const phone = document.getElementById('wd-phone').value;

        if(!amt || amt < 50) return alert("á‰¢á‹«áŠ•áˆµ 50 á‰¥áˆ­ áˆ›á‹áŒ£á‰µ á‹­á‰½áˆ‹áˆ‰!");
        if(!phone) return alert("áŠ¥á‰£áŠ­á‹ áˆµáˆáŠ­ á‰áŒ¥áˆ­ á‹«áˆµáŒˆá‰¡!");
        if(myBal < amt) return alert("á‰ á‰‚ á‰£áˆ‹áŠ•áˆµ á‹¨áˆˆá‹á‰µáˆ!");

        // áˆ˜áŒ€áˆ˜áˆªá‹« á‰£áˆ‹áŠ•áˆ±áŠ• á‰€áŠ•áˆ¥
        db.ref('users/' + uid + '/bal').set(myBal - amt).then(() => {
            // áˆˆá‹³áŠ›á‹ áŒ¥á‹«á‰„ áˆ‹áŠ­
            db.ref('withdraw_requests').push({
                uid: uid,
                name: tg.initDataUnsafe.user.first_name,
                amount: amt,
                phone: phone,
                status: 'pending'
            });
            alert("á‹¨áˆ›á‹áŒ« áŒ¥á‹«á‰„á‹ á‰°áˆáŠ³áˆ! á‹³áŠ›á‹ á‰ á‰…áˆ­á‰¡ á‹­áˆáŠ­áˆá‹á‰³áˆá¢");
            document.getElementById('wd-amt').value = "";
            document.getElementById('wd-phone').value = "";
        });
    }

    // 2. áŠ á‹µáˆšáŠ• áŒˆáŒ½ áˆ‹á‹­ áŒ¥á‹«á‰„á‹á‰½áŠ• áˆ›áˆ³á‹« (showAdmin function á‹áˆµáŒ¥ á‹­áŒ¨áˆ˜áˆ«áˆ)
    function loadWithdrawRequests() {
        db.ref('withdraw_requests').on('value', s => {
            const list = document.getElementById('wd-list');
            list.innerHTML = "";
            s.forEach(child => {
                const r = child.val();
                if(r.status == 'pending') {
                    let div = document.createElement('div');
                    div.style = "background:#1e293b; padding:10px; margin-bottom:10px; border-left:4px solid var(--red); text-align:left;";
                    div.innerHTML = `
                        <b>áˆµáˆ:</b> ${r.name} <br>
                        <b>áˆ˜áŒ áŠ•:</b> ${r.amount} ETB <br>
                        <b>áˆµáˆáŠ­:</b> ${r.phone} <br>
                        <button onclick="approveWithdraw('${child.key}')" style="background:var(--green); color:white; border:none; padding:5px 10px; border-radius:4px; margin-top:5px;">á‰°áŠ¨ááˆáˆ (Paid)</button>
                    `;
                    list.appendChild(div);
                }
            });
        });
    }

    function approveWithdraw(key) {
        if(confirm("áˆˆá‹šáˆ… á‰°áŒ«á‹‹á‰½ áˆ˜áŠ­áˆáˆá‹áŠ• áŠ áˆ¨áŒ‹áŒáŒ á‹‹áˆ?")) {
            db.ref('withdraw_requests/' + key).update({ status: 'paid' });
            alert("á‰°áŠ¨ááˆáˆ á‰°á‰¥áˆ á‰°áˆ˜á‹áŒá‰§áˆá¢");
        }
    }
    
    // showAdmin function áˆ²áŒ áˆ« loadWithdrawRequests() áŠ¥áŠ•á‹²áŒ¨áˆáˆ­ áˆ›á‹µáˆ¨áŒ áŠ á‰µáˆ­áˆ³
</script>















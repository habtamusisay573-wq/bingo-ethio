<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ETHIO BINGO GOLD</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --gold: #facc15; --bg: #0f172a; --card: #1e293b; --green: #22c55e; --red: #ef4444; --indigo: #6366f1; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; overflow-x: hidden; }
        
        /* Splash Screen */
        #splash { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; transition: 0.8s; }
        .logo-text { font-size: 3rem; font-weight: 900; color: var(--gold); text-shadow: 0 0 20px rgba(250, 204, 21, 0.5); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

        /* UI Elements */
        .header { display: flex; justify-content: space-between; padding: 12px; background: #111827; border-bottom: 2px solid var(--gold); position: sticky; top:0; z-index:100; }
        .page { display: none; padding: 15px; animation: fadeIn 0.4s; min-height: 90vh; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .ball { width: 75px; height: 75px; background: radial-gradient(circle at 30% 30%, #fff, var(--gold), #a16207); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.2rem; font-weight: 900; color: #000; margin: 15px auto; border: 3px solid #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .bingo-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; background: #cbd5e1; padding: 10px; border-radius: 12px; max-width: 320px; margin: auto; }
        .cell { aspect-ratio: 1; background: white; color: #1e293b; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 6px; font-size: 1.1rem; cursor: pointer; transition: 0.2s; }
        .cell.marked { background: var(--red) !important; color: white !important; border-radius: 50%; transform: scale(0.9); }

        .btn { width: 100%; padding: 14px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.2s; }
        .btn:active { transform: scale(0.98); }
        .btn-gold { background: var(--gold); color: black; }
        
        .card-picker-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; max-height: 400px; overflow-y: auto; padding: 5px; }
        .card-num-btn { background: var(--card); border: 1px solid #334155; color: white; padding: 12px; border-radius: 8px; font-weight: bold; }

        input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; margin: 5px 0; box-sizing: border-box; }
        .tx-card { background: var(--card); padding: 12px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid var(--gold); text-align: left; }
    </style>
</head>
<body>

    <div id="splash">
        <div class="logo-text">ETHIO BINGO</div>
        <p style="color: #94a3b8; margin-top: 10px;">á‰ áˆ˜áŒ«áŠ• áˆ‹á‹­...</p>
    </div>

    <div id="app-content" style="display:none;">
        <div class="header">
            <div id="u-name">áˆ°áˆ‹áˆ</div>
            <div id="u-bal" style="color:var(--green); font-weight:bold;">0.00 ETB</div>
        </div>

        <div id="home-page" class="page active">
            <h3 style="color:var(--gold)">á‹¨áˆ˜á‹ˆáˆ«áˆ¨áŒƒ áˆ˜áŒ áŠ• á‹­áˆáˆ¨áŒ¡</h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                <div onclick="goToCardPicker(10)" style="background:var(--card); padding:20px 10px; border-radius:12px; border:1px solid #334155;"><b>10</b><br><small>ETB</small></div>
                <div onclick="goToCardPicker(50)" style="background:var(--card); padding:20px 10px; border-radius:12px; border:1px solid #334155;"><b>50</b><br><small>ETB</small></div>
                <div onclick="goToCardPicker(100)" style="background:var(--card); padding:20px 10px; border-radius:12px; border:1px solid #334155;"><b>100</b><br><small>ETB</small></div>
            </div>

            <div style="margin-top:20px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button class="btn btn-gold" onclick="showForm('dep-form')">ğŸ“¥ á‰¥áˆ­ áŠ áˆµáŒˆá‰£</button>
                <button class="btn" style="background:var(--red); color:white;" onclick="showForm('wd-form')">ğŸ“¤ á‰¥áˆ­ áŠ á‹áŒ£</button>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button class="btn" style="background:var(--indigo); color:white;" onclick="showTransactions()">ğŸ“œ á‰³áˆªáŠ­</button>
                <button class="btn" style="background:#444; color:white;" onclick="showPage('rules-page')">âš–ï¸ á‹°áŠ•á‰¦á‰½</button>
            </div>

            <div id="dep-form" style="display:none; background:var(--card); padding:15px; border-radius:12px; margin-top:10px;">
                <p style="font-size:0.8rem; color:var(--gold)">á‰´áˆŒá‰¥áˆ­: 0991243423</p>
                <input type="text" id="tid" placeholder="á‹¨áŒá‰¥á‹­á‰µ á‰áŒ¥áˆ­ (TID)">
                <button class="btn btn-gold" onclick="sendPayment()">áŒ¥á‹«á‰„ áˆ‹áŠ­</button>
            </div>

            <div id="wd-form" style="display:none; background:var(--card); padding:15px; border-radius:12px; margin-top:10px;">
                <input type="number" id="wd-amt" placeholder="á‹¨á‰¥áˆ­ áˆ˜áŒ áŠ•">
                <input type="text" id="wd-phone" placeholder="áˆµáˆáŠ­ á‰áŒ¥áˆ­">
                <button class="btn btn-gold" onclick="requestWithdraw()">áŒ¥á‹«á‰„ áˆ‹áŠ­</button>
            </div>
            
            <button id="admin-btn" class="btn" style="background:var(--green); display:none; margin-top:20px;" onclick="showAdmin()">ğŸ”§ á‹³áŠ› áŒˆáŒ½</button>
        </div>

        <div id="rules-page" class="page">
            <h3 style="color:var(--gold)">á‹¨áŒ¨á‹‹á‰³ á‹°áŠ•á‰¦á‰½</h3>
            <div class="tx-card" style="line-height:1.6;">
                1. <b>áŠ®áˆšáˆ½áŠ•:</b> áŠ¨áŒ á‰…áˆ‹áˆ‹ áŒˆá‰¢ áˆ‹á‹­ 20% áˆˆá‰¤á‰µ á‹­á‰€áŠáˆ³áˆá¢<br>
                2. <b>á‰¢áŠ•áŒ:</b> á‰áŒ¥áˆ© áŠ¥áŠ•á‹°á‹ˆáŒ£ á‹ˆá‹²á‹«á‹ "BINGO" áˆ›áˆˆá‰µ áŒá‹´á‰³ áŠá‹á¢<br>
                3. <b>áŠ­áá‹«:</b> á‰µáŠ­áŠ­áˆˆáŠ› TID áŠ«áˆá‰°áˆ‹áŠ¨ á‰£áˆ‹áŠ•áˆµ áŠ á‹­áˆáˆ‹áˆá¢<br>
                4. <b>áˆ›á‹áŒ«:</b> á‹á‰…á‰°áŠ›á‹ áˆ›á‹áŒ« 50 ETB áŠá‹á¢<br>
                5. <b>áˆ€áˆ‹áŠáŠá‰µ:</b> á‰ áŠ¢áŠ•á‰°áˆ­áŠ”á‰µ áˆ˜á‰†áˆ«áˆ¨áŒ¥ áˆˆáˆšáŒ á‹ áŠ«áˆ­á‰´áˆ‹ á‰¤á‰± áˆ€áˆ‹áŠáŠá‰µ áŠ á‹­á‹ˆáˆµá‹µáˆá¢
            </div>
            <button class="btn" style="background:#444; color:white;" onclick="showPage('home-page')">á‰°áˆ˜áˆˆáˆµ</button>
        </div>

        <div id="tx-page" class="page">
            <h3 style="color:var(--gold)">á‹¨áŠ¥áŠ•á‰…áˆµá‰ƒáˆ´ á‰³áˆªáŠ­</h3>
            <div id="tx-list">á‰³áˆªáŠ­ á‹¨áˆˆáˆ...</div>
            <button class="btn" style="background:#444; color:white;" onclick="showPage('home-page')">á‰°áˆ˜áˆˆáˆµ</button>
        </div>

        <div id="picker-page" class="page">
            <h3 style="color:var(--gold)">áŠ«áˆ­á‰´áˆ‹ á‹­áˆáˆ¨áŒ¡ (1-200)</h3>
            <div class="card-picker-grid" id="card-list"></div>
            <button class="btn" style="background:#444; color:white;" onclick="showPage('home-page')">á‰°áˆ˜áˆˆáˆµ</button>
        </div>

        <div id="game-page" class="page">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom:10px;">
                <button onclick="confirmExit()" style="background:var(--red); color:white; border:none; padding:8px 15px; border-radius:8px; font-weight:bold;">â¬… á‹áŒ£</button>
                <span id="active-card-label" style="color:var(--gold); font-weight:bold; font-size:1.1rem;"></span>
            </div>
            <div class="ball" id="live-ball">?</div>
            <div class="bingo-grid" id="board"></div>
            <button class="btn btn-gold" style="margin-top:25px; font-size:1.2rem;" onclick="claimBingo()">BINGO!</button>
        </div>

        <div id="admin-page" class="page">
            <h2 style="color:var(--gold)">á‹³áŠ› áˆ˜á‰†áŒ£áŒ áˆªá‹«</h2>
            <div id="admin-ball" class="ball">?</div>
            <button class="btn btn-gold" onclick="drawSingle()">á‰áŒ¥áˆ­ áŠ á‹áŒ£</button>
            <button id="auto-btn" class="btn" style="background:var(--green); color:white;" onclick="toggleAuto()">Auto áŒ€áˆáˆ­</button>
            
            <h4 style="color:var(--gold); margin-top:20px; text-align:left;">ğŸ“© áŒˆá‰¢/á‹ˆáŒª áŒ¥á‹«á‰„á‹á‰½</h4>
            <div id="admin-req-list"></div>
            
            <button class="btn btn-red" onclick="resetGame()" style="margin-top:30px;">RESET GAME</button>
            <button class="btn" onclick="showPage('home-page')">á‹ˆá‹° áˆ˜áŠáˆ»</button>
        </div>
    </div>

    <script>
        const ADMIN_ID = 8431270634;
        const firebaseConfig = { databaseURL: "https://dagi-bingo-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;
        tg.expand();

        // SplashScreen Logic
        setTimeout(() => {
            document.getElementById('splash').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('splash').style.display = 'none';
                document.getElementById('app-content').style.display = 'block';
            }, 800);
        }, 2000);

        let myBal = 0, drawn = [], autoInterval = null, selectedPrice = 0, currentCard = 0;
        const uid = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 0;
        const uName = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.first_name : "á‰°áŒ«á‹‹á‰½";

        if(uid == ADMIN_ID) document.getElementById('admin-btn').style.display = 'block';
        document.getElementById('u-name').innerText = "áˆ°áˆ‹áˆ " + uName;

        db.ref('users/' + uid + '/bal').on('value', s => { 
            myBal = s.val() || 0; 
            document.getElementById('u-bal').innerText = myBal.toFixed(2) + " ETB"; 
        });

        db.ref('game/drawn').on('value', s => { 
            drawn = s.val() || []; 
            const last = drawn[drawn.length-1] || "?";
            document.getElementById('live-ball').innerText = last; 
            document.getElementById('admin-ball').innerText = last; 
        });

        function showForm(id) { 
            document.getElementById('dep-form').style.display = 'none'; 
            document.getElementById('wd-form').style.display = 'none'; 
            document.getElementById(id).style.display = 'block'; 
        }

        function addTx(type, amt, desc) {
            db.ref('users/'+uid+'/tx').push({ type, amt, desc, time: new Date().toLocaleTimeString() });
        }

        function sendPayment() {
            const t = document.getElementById('tid').value;
            if(!t) return alert("TID á‹«áˆµáŒˆá‰¡");
            db.ref('all_requests').push({ uid, name: uName, tid: t, type: 'DEP', status: 'pending' });
            alert("áŒ¥á‹«á‰„ á‰°áˆáŠ³áˆ!");
            document.getElementById('tid').value = "";
        }

        function requestWithdraw() {
            const amt = parseFloat(document.getElementById('wd-amt').value);
            const ph = document.getElementById('wd-phone').value;
            if(amt < 50 || myBal < amt) return alert("áˆµáˆ…á‰°á‰µ áŠ áˆˆ! á‰£áˆ‹áŠ•áˆµá‹áŠ• á‹ˆá‹­áˆ áˆ˜áŒ áŠ•á‹áŠ• á‹«áˆ¨áŒ‹áŒáŒ¡ (Min 50)");
            db.ref('users/'+uid+'/bal').set(myBal - amt);
            db.ref('all_requests').push({ uid, name: uName, amount: amt, phone: ph, type: 'WD', status: 'pending' });
            addTx('WITHDRAW', amt, 'á‹¨á‹ˆáŒª áŒ¥á‹«á‰„');
            alert("áŒ¥á‹«á‰„ á‰°áˆáŠ³áˆ!");
        }

        function showTransactions() {
            showPage('tx-page');
            db.ref('users/'+uid+'/tx').limitToLast(15).on('value', s => {
                const list = document.getElementById('tx-list'); list.innerHTML = "";
                s.forEach(c => {
                    let r = c.val();
                    let d = document.createElement('div'); d.className = 'tx-card';
                    d.innerHTML = `<b>${r.type}</b>: ${r.amt} ETB <br> <small>${r.desc} | ${r.time}</small>`;
                    list.prepend(d);
                });
            });
        }

        function goToCardPicker(price) {
            if(myBal < price) return alert("á‰ á‰‚ á‰£áˆ‹áŠ•áˆµ á‹¨áˆˆáˆ!");
            selectedPrice = price;
            showPage('picker-page');
            const list = document.getElementById('card-list'); list.innerHTML = "";
            for(let i=1; i<=200; i++) {
                let b = document.createElement('button'); b.className = 'card-num-btn'; b.innerText = i;
                b.onclick = () => startGame(i); list.appendChild(b);
            }
        }

        function startGame(n) {
            currentCard = n;
            db.ref('users/'+uid+'/bal').set(myBal - selectedPrice);
            addTx('PLAY', selectedPrice, 'áŠ«áˆ­á‰´áˆ‹ #' + n);
            document.getElementById('active-card-label').innerText = "áŠ«áˆ­á‰´áˆ‹ #" + n;
            showPage('game-page');
            const board = document.getElementById('board'); board.innerHTML = "";
            let pool = Array.from({length: 75}, (_, i) => i + 1).sort(() => Math.random() - 0.5);
            for(let i=0; i<25; i++) {
                let c = document.createElement('div'); c.className = 'cell'; c.innerText = pool[i];
                c.onclick = function() { this.classList.toggle('marked'); }; board.appendChild(c);
            }
        }

        function claimBingo() {
            db.ref('all_requests').push({ uid, name: uName, card: currentCard, price: selectedPrice, type: 'BINGO', status: 'pending' });
            alert("á‰¢áŠ•áŒ áˆˆá‹³áŠ›á‹ á‰°áˆáŠ³áˆ! áŠ¥á‰£áŠ­á‹ áŠ«áˆ­á‰´áˆ‹á‹áŠ• Screenshot áŠ áŠ•áˆµá‰°á‹ áŒáˆ©á‘ áˆ‹á‹­ á‹­áˆ‹áŠ©á¢");
        }

        function showAdmin() {
            showPage('admin-page');
            db.ref('all_requests').on('value', s => {
                const list = document.getElementById('admin-req-list'); list.innerHTML = "";
                s.forEach(c => {
                    let r = c.val(); if(r.status == 'pending') {
                        let d = document.createElement('div'); d.className = 'tx-card';
                        if(r.type == 'DEP') d.innerHTML = `ğŸ’° DEP: ${r.name} | TID: ${r.tid} <br> <button onclick="approveDep('${c.key}','${r.uid}')" class="btn btn-gold">áŠ áŒ½á‹µá‰…</button>`;
                        else if(r.type == 'WD') d.innerHTML = `ğŸ“¤ WD: ${r.name} | ${r.amount} ETB | ${r.phone} <br> <button onclick="approveWd('${c.key}')" class="btn" style="background:var(--red); color:white;">á‰°áŠ¨áˆáˆˆ</button>`;
                        else if(r.type == 'BINGO') d.innerHTML = `ğŸ† BINGO: ${r.name} | #${r.card} | ${r.price} ETB <br> <button onclick="approveBingo('${c.key}')" class="btn btn-gold">á‰°áˆ¨áŒ‹áŒˆáŒ </button>`;
                        list.appendChild(d);
                    }
                });
            });
        }

        function approveDep(k,u) { 
            let a = prompt("áˆ˜áŒ áŠ• á‹«áˆµáŒˆá‰¡:"); 
            if(a) { 
                db.ref('users/'+u+'/bal').transaction(b=>(b||0)+parseFloat(a)); 
                db.ref('all_requests/'+k).update({status:'ok'}); 
                db.ref('users/'+u+'/tx').push({type:'DEPOSIT', amt:a, desc:'á‰°á‰€á‰£á‹­áŠá‰µ áŠ áŒáŠá‰·áˆ', time:new Date().toLocaleTimeString()});
            } 
        }
        function approveWd(k) { db.ref('all_requests/'+k).update({status:'ok'}); alert("á‰°áŠ¨áˆáˆˆ!"); }
        function approveBingo(k) { db.ref('all_requests/'+k).update({status:'ok'}); alert("áŠ áˆ¸áŠ“áŠ á‰°áˆ¨áŒ‹áŒáŒ§áˆ!"); }

        function drawSingle() { 
            if(drawn.length >= 75) return alert("á‰áŒ¥áˆ®á‰½ áŠ áˆá‰€á‹‹áˆ!");
            let n; do { n = Math.floor(Math.random()*75)+1; } while(drawn.includes(n));
            drawn.push(n); db.ref('game/drawn').set(drawn); 
        }

        function toggleAuto() { 
            const b = document.getElementById('auto-btn'); 
            if(autoInterval) { clearInterval(autoInterval); autoInterval = null; b.innerText = "Auto áŒ€áˆáˆ­"; b.style.background = "var(--green)"; } 
            else { autoInterval = setInterval(drawSingle, 4000); b.innerText = "áŠ á‰áˆ"; b.style.background = "var(--red)"; } 
        }

        function resetGame() { if(confirm("áˆáˆ‰áŠ•áˆ á‰áŒ¥áˆ®á‰½ áˆ‹áŒ¥á‹?")) db.ref('game/drawn').set([]); }
        function confirmExit() { if(confirm("áˆ˜á‹áŒ£á‰µ á‰µáˆáˆáŒ‹áˆˆáˆ…? á‹¨á‰†áˆ¨áŒ¥áŠ¨á‹ á‰¥áˆ­ áŠ á‹­áˆ˜áˆˆáˆµáˆá¢")) showPage('home-page'); }
        function showPage(p) { document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active')); document.getElementById(p).classList.add('active'); }
    </script>
</body>
</html>
